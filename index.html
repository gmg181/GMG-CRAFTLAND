<!DOCTYPE html>
<html>
<head>
  <title>Craftland Maps</title>
  <style>
    body { font-family: sans-serif; background: #f2f2f2; padding: 20px; }
    .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 5px #ccc; }
    img { max-width: 100%; border-radius: 8px; }
    button { background: #4CAF50; color: white; border: none; padding: 8px 12px; margin-top: 5px; cursor: pointer; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>üó∫Ô∏è Upload Craftland Map</h2>
  <input type="text" id="code" placeholder="Enter map code"><br><br>
  <input type="file" id="image" accept="image/png"><br><br>
  <button onclick="upload()">Upload</button>

  <h2>üéÆ Uploaded Maps</h2>
  <div id="maps"></div>

  <script>
    async function upload() {
      const code = document.getElementById("code").value;
      const file = document.getElementById("image").files[0];
      if (!code || !file) return alert("Please enter map code and image.");

      const reader = new FileReader();
      reader.onloadend = async () => {
        const res = await fetch('/api/upload', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ code, image: reader.result })
        });
        if (res.ok) {
          alert("Uploaded!");
          loadMaps();
        } else {
          alert("Upload failed.");
        }
      };
      reader.readAsDataURL(file);
    }

    async function loadMaps() {
      const res = await fetch('/maps.json');
      const maps = await res.json();
      const div = document.getElementById("maps");
      div.innerHTML = '';
      maps.reverse().forEach((map, i) => {
        div.innerHTML += `
          <div class="card">
            <img src="${map.image}" alt="map">
            <p><b>Code:</b> <span id="code${i}">${map.code}</span></p>
            <button onclick="copyCode(${i})">Copy Code</button>
          </div>`;
      });
    }

    function copyCode(i) {
      const text = document.getElementById("code" + i).innerText;
      navigator.clipboard.writeText(text).then(() => alert("Copied: " + text));
    }

    loadMaps();
  </script>
</body>
</html>
